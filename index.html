<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Norms and Process By Persona</title>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color-1: #1B998B;
      --primary-color-2: #bf4bcc;
      --primary-color-3: #457B9D;
      --primary-color-4: #F4A261;
      --secondary-color: #f9f9f9;
      --popup-bg: white;
      --popup-border: #ddd;
      --text-color: #333;
      --hover-shadow: rgba(0, 0, 0, 0.2);

      /* Define colors for each persona */
      --maintimeline-color: #5f83cc;
      --staff-color: #5cb6ab;
      --people-leader-color: #9a33c3;
      --project-leader-color: #457B9D;
      --business-leader-color: #F4A261;
    }
    body {
      font-family: 'Open Sans', Arial, Helvetica, sans-serif;
      font-weight: lighter;
      margin: 0;
      display: flex;
      flex-direction: row;
      height: 100vh;
      background-color: var(--secondary-color);
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Open Sans', Arial, sans-serif; /* Use a modern, clean font */
      font-weight: 500; /* Light font weight for headings */
      color: var(--text-color); /* Use a neutral text color */
      letter-spacing: 0.5px; /* Add slight letter spacing for readability */
      line-height: 1.3; /* Adjust line height for better readability */
      margin: 0 0 15px; /* Add spacing below headings */
    }

    .filter-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center; /* Center buttons horizontally */
      justify-content: center; /* Center buttons vertically */
      padding: 20px;
      background-color: var(--secondary-color);
      border-right: 1px solid var(--popup-border);
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
      height: 100vh; /* Make it span the full viewport height */
    }


    .filter-btn {
      position: relative; /* Required for positioning the tooltip */
      width: 60px;
      height: 60px;
      border: none;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      cursor: pointer;
      transition: transform 0.2s ease, border 0.2s ease, box-shadow 0.2s ease;
    }

    .filter-btn::after {
      content: attr(data-tooltip); /* Use the data-tooltip attribute for the tooltip text */
      position: absolute;
      bottom: 110%; /* Position above the button */
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--popup-bg); /* Use a neutral background */
      color: var(--text-color); /* Neutral text color */
      font-size: 12px;
      padding: 5px 10px;
      border-radius: 5px;
      box-shadow: 0 2px 4px var(--hover-shadow);
      white-space: nowrap; /* Prevent wrapping */
      opacity: 0; /* Hide by default */
      visibility: hidden; /* Hide by default */
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }

    .filter-btn:hover::after {
      opacity: 1; /* Show on hover */
      visibility: visible;
    }

    .step-title {
      font-size: 10px;
      color: var(--text-color); /* Neutral text color */
      margin-bottom: 5px; /* Add spacing between title and circle */
      text-align: center; /* Center-align titles */
      white-space: nowrap; /* Prevent text wrapping */
    }

    .timeline-section {
      flex: 0.5;
      display: flex;
      flex-direction: column;
      padding: 10px;
      gap: 60px; /* Space between timelines */
      overflow-y: auto;
      align-items: right; /* Center content horizontally */
    }

    .timeline-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr); /* Equal-width columns */
      justify-items: center; /* Center each node horizontally */
      align-items: center; /* Center each node vertically */
      gap: 20px; /* Space between nodes */
      padding: 20px;
    }

    .timeline-container.main {
      background-color: #f8f9fa; /* Neutral light gray */
      border: 1px solid #ddd; /* Subtle border */
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Light shadow for depth */
      padding: 20px;
    }

    .timeline-container.expanded {
      /* border: 1px solid var(--primary-color-3); */
      background-color: white;
    }

    .timeline-container.collapsed {
      display: none;
    }

    .timeline-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .timeline-step .circle {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background-color: var(--maintimeline-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: white;
  opacity: 0.8;
  transition: transform 0.2s ease, opacity 0.2s ease, box-shadow 0.2s ease;
  position: relative;
}

.timeline-step .circle i {
  line-height: 1;
}

.timeline-step .circle .hidden-step {
  display: none;
  /* Preserve the step number for selection logic but hide it visually */
}

/* Ensure proper icon sizing and centering */
.timeline-step .circle i {
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}

  /* Selected node styling */
  .timeline-step.selected .circle {
    opacity: 1; /* Brighten when selected */
    transform: scale(1.1); /* Slightly enlarge */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Add shadow for emphasis */
    border: 2px solid #000; /* Black border to differentiate selection */
  }


    .timeline-step:hover .circle {
      opacity: 1;
      transform: scale(1.1);
      box-shadow: 0 4px 8px var(--hover-shadow);
    }

    .timeline-title {
      margin-bottom: 10px; /* Space between title and timeline */
      font-size: 1.2rem; /* Slightly smaller font size for elegance */
      font-weight: 300; /* Light font weight for a modern feel */
      color: var(--text-color); /* Use neutral text color */
      text-align: left; /* Align text to the left */
      font-family: 'Open Sans', Arial, sans-serif; /* Use a light, modern font */
      letter-spacing: 0.5px; /* Add slight letter spacing for readability */
      line-height: 1.4; /* Adjust line height for better readability */
    }

    .overlay {
      width: 400px;
      background-color: var(--popup-bg);
      border-left: 1px solid var(--popup-border);
      padding: 20px;
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
      display: flex;
      flex: 1.25;
      flex-direction: column;
      overflow-y: auto;
    }

    .close-btn {
      font-size: 20px;
      cursor: pointer;
      margin-bottom: 20px;
      align-self: flex-end;
    }

    .timeline-popup-above,
    .timeline-popup-below {
      position: absolute;
      background-color: var(--popup-bg); /* Background color for the popup */
      border: 1px solid var(--popup-border); /* Border color */
      border-radius: 8px; /* Rounded corners */
      padding: 10px; /* Padding for content */
      font-size: 0.9rem; /* Font size */
      color: var(--text-color); /* Text color */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Subtle shadow for depth */
      opacity: 0; /* Hidden by default */
      visibility: hidden; /* Hidden by default */
      transition: opacity 0.3s ease, visibility 0.3s ease; /* Smooth transitions */
      z-index: 1000; /* Ensure it appears above other elements */
      max-width: 200px; /* Limit the width of the popup */
      text-align: center; /* Center-align text */
      display: none
    }

    .timeline-popup-above {
      bottom: 110%; /* Position above the node */
      left: 50%;
      transform: translateX(-50%); /* Center horizontally */
    }

    .timeline-popup-below {
      top: 110%; /* Position below the node */
      left: 50%;
      transform: translateX(-50%); /* Center horizontally */
    }

    /* Show popups on hover */
    .timeline-step:hover .timeline-popup-above,
    .timeline-step:hover .timeline-popup-below {
      opacity: 1; /* Fully visible */
      visibility: visible; /* Fully visible */
    }

    /* Add an arrow pointing to the node */
    .timeline-popup-above::after,
    .timeline-popup-below::after {
      content: '';
      position: absolute;
      border-style: solid;
      border-width: 6px;
      display: block;
      width: 0;
    }

    .timeline-popup-above::after {
      bottom: -6px; /* Position at the bottom of the popup */
      left: 50%;
      transform: translateX(-50%);
      border-color: var(--popup-bg) transparent transparent transparent;
    }

    .timeline-popup-below::after {
      top: -6px; /* Position at the top of the popup */
      left: 50%;
      transform: translateX(-50%);
      border-color: transparent transparent var(--popup-bg) transparent;
    }


    .filter-btn[data-target="staff"].active {
      border: 4px solid var(--staff-color); /* Match staff color */
    }

    .filter-btn[data-target="peopleleader"].active {
      border: 4px solid var(--people-leader-color); /* Match people leader color */
    }

    .filter-btn[data-target="projectleader"].active {
      border: 4px solid var(--project-leader-color); /* Match project leader color */
    }

    .filter-btn[data-target="businessleader"].active {
      border: 4px solid var(--business-leader-color); /* Match business leader color */
    }


    /* Node styles with persona colors */
    .timeline-container[data-persona="staff"] .circle {
      background-color: var(--staff-color);
    }

    .timeline-container[data-persona="peopleleader"] .circle {
      background-color: var(--people-leader-color);
    }

    .timeline-container[data-persona="projectleader"] .circle {
      background-color: var(--project-leader-color);
    }

    .timeline-container[data-persona="businessleader"] .circle {
      background-color: var(--business-leader-color);
    }

    .timeline-step.selected .circle {
      border: 2px solid #1B998B; /* Highlight selected nodes */
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>

<body>
  <div class="filter-buttons">
    <button class="filter-btn" data-target="staff" data-tooltip="Staff"><i class="fas fa-user"></i></button>
    <button class="filter-btn" data-target="peopleleader" data-tooltip="People Leader"><i class="fas fa-users"></i></button>
    <button class="filter-btn" data-target="projectleader" data-tooltip="Project Leader"><i class="fas fa-tasks"></i></button>
    <button class="filter-btn" data-target="businessleader" data-tooltip="Business Leader"><i class="fas fa-briefcase"></i></button>
  </div>
  <div class="timeline-section">
    <center><h1>Project Timeline</h1></center>
    <!-- Main Timeline -->
    <div class="timeline-container main">
    </div>
    <!-- Dynamic timelines for personas -->
    <div class="timeline-container collapsed" data-persona="staff">
    </div>
    <div class="timeline-container collapsed" data-persona="peopleleader">
    </div>
    <div class="timeline-container collapsed" data-persona="projectleader">
    </div>
    <div class="timeline-container collapsed" data-persona="businessleader">
    </div>
  </div>

  <div class="overlay" id="overlay">
    <!-- <div class="close-btn" onclick="closeOverlay()">×</div> -->
    <div id="overlay-text">Click on a node to display a persona norms and processes.</div>
  </div>

  <!-- <script>
    function closeOverlay() {
      document.getElementById('overlay').style.display = 'none';
    }
  </script> -->

  <script>
// Data Configuration
const TIMELINE_DATA = {
  popupBelowData: {
    staff: [
      "Staff should <a href='https://example.com/skills' target='_blank'>update skills</a> and be proactive in identifying projects.",
      "Staff require support from leaders to <a href='https://example.com/opportunities' target='_blank'>identify opportunities</a>.",
      "Staff need clear communication with <a href='https://example.com/project-leaders' target='_blank'>Project Leaders</a>.",
      "Staff must understand their <a href='https://example.com/roles' target='_blank'>roles</a> when held to a project.",
      "Staff should know their <a href='https://example.com/allocation' target='_blank'>time allocation</a> for a project.",
      "Staff should request <a href='https://example.com/feedback' target='_blank'>performance feedback</a>.",
      "Staff should request advance notice for <a href='https://example.com/close-out' target='_blank'>project close-out</a>.",
      "Staff should <a href='https://example.com/commitments' target='_blank'>deliver on commitments</a> before project close-out."
    ],
    peopleleader: [
      "People Leaders request labor details from Project Leaders.",
      "People Leaders assist staff in finding growth opportunities.",
      "People Leaders provide insights into staff skills.",
      "People Leaders request updates on project changes.",
      "People Leaders request feedback on staff performance.",
      "People Leaders manage coverage across projects.",
      "People Leaders support project close-out.",
      "People Leaders assist staff transitioning to new projects."
    ],
    projectleader: [
      "Project Leaders request project details from managers.",
      "Project Leaders collaborate on budgets and resources.",
      "Project Leaders define roles and assign staff.",
      "Project Leaders track financial updates.",
      "Project Leaders communicate scope changes.",
      "Project Leaders request performance reports.",
      "Project Leaders ensure project close-out.",
      "Project Leaders notify close-out timelines."
    ],
    businessleader: [
      "Business Leaders collaborate on staff planning.",
      "Business Leaders request pricing details.",
      "Business Leaders add project codes.",
      "Business Leaders request status updates.",
      "Business Leaders guide on execution (e.g., burn rates).",
      "Business Leaders track allocation changes.",
      "Business Leaders request trailing cost details.",
      "Business Leaders ensure project requirement completion."
    ]
  },
  categories: [
    { id: 0, name: "Setup", steps: ["1.1", "1.2", "1.3"], icon: '<i class="fas fa-tools"></i>' },
    { id: 1, name: "Performance", steps: ["2.1", "2.2", "2.3", "2.4"], icon: '<i class="fas fa-cogs"></i>' },
    { id: 2, name: "Close", steps: ["2.5"], icon: '<i class="fas fa-flag-checkered"></i>' }
  ],
  titles: [
    "Identify Opportunity",
    "Mature Opportunity to High Confidence",
    "Manage High Confidence Opportunity",
    "Launch Project",
    "Manage Project",
    "Report Progress",
    "Deliver Results",
    "Close Project"
  ]
};

class TimelineGenerator {
  // Add a mapping for category icons
  static categoryIcons = {
    0: '<i class="fas fa-rocket"></i>', // Pre-Project: rocket icon
    1: '<i class="fas fa-cogs"></i>',   // Project Execution: cogs icon
    2: '<i class="fas fa-flag"></i>'    // Project Close: flag icon
  };

  static generateMainTimeline() {
    return TIMELINE_DATA.categories
      .map(category => `
        <div class="timeline-step" data-category="${category.id}">
          <div class="step-title">${category.name}</div>
          <div class="circle">${category.icon}</div>
        </div>`)
      .join('');
  }

  static generatePersonaTimeline(persona) {
    const popupData = TIMELINE_DATA.popupBelowData[persona.toLowerCase().replace(/ /g, '')];
    if (!popupData) {
      console.warn(`No data found for persona: ${persona}`);
      return '';
    }

    return TIMELINE_DATA.categories
      .map(category => {
        const relevantSteps = category.steps.map(step => {
          const [majorStep, minorStep] = step.split('.').map(Number);
          let index;
          if (majorStep === 1) {
            index = minorStep - 1;
          } else if (majorStep === 2) {
            index = 3 + (minorStep - 1);
          }
          return popupData[index] || '';
        }).filter(Boolean);

        // Store both step number and category ID for proper tracking
        return `
          <div class="timeline-step" data-category="${category.id}">
            <div class="circle" data-step="${category.steps[0]}">
              ${TimelineGenerator.categoryIcons[category.id]}
              <span class="hidden-step">${category.steps[0]}</span>
            </div>
            <div class="timeline-popup-above">${category.name}</div>
            <div class="timeline-popup-below" data-full-text="${relevantSteps.join('<br>')}">
              ${relevantSteps.join('<br>')}
            </div>
          </div>`;
      })
      .join('');
  }
}

// Selection Manager
class SelectionManager {
  constructor() {
    this.selectedNodes = [];
  }

  toggleNodeSelection(timelineStep, persona) {
    // Get the step from the data attribute
    const step = timelineStep.querySelector('.circle').dataset.step;
    const title = timelineStep.querySelector('.timeline-popup-above')?.textContent || 'Title not available';
    const text = timelineStep.querySelector('.timeline-popup-below')?.dataset.fullText || 'Text not available';
    const uniqueIdentifier = `${step}-${persona}`;

    const nodeIndex = this.selectedNodes.findIndex(node => node.id === uniqueIdentifier);

    if (nodeIndex > -1) {
      this.selectedNodes.splice(nodeIndex, 1);
      timelineStep.classList.remove('selected');
    } else {
      this.selectedNodes.push({ id: uniqueIdentifier, step, title, text, persona });
      timelineStep.classList.add('selected');
    }

    this.updateOverlay();
  }

  updateOverlay() {
    const overlayText = document.getElementById('overlay-text');
    
    if (!overlayText) {
      console.warn('Overlay text element not found');
      return;
    }
    
    if (this.selectedNodes.length === 0) {
      overlayText.innerHTML = '<p>No nodes selected. Click a node to see details.</p>';
      return;
    }

    const groupedNodes = this.groupNodesByStep();
    const sortedContent = this.generateSortedContent(groupedNodes);
    overlayText.innerHTML = sortedContent;
  }

  groupNodesByStep() {
    return this.selectedNodes.reduce((acc, node) => {
      if (!acc[node.step]) {
        acc[node.step] = { title: node.title, text: [] };
      }
      acc[node.step].text.push(node.text);
      return acc;
    }, {});
  }

  generateSortedContent(groupedNodes) {
    const sortedSteps = Object.keys(groupedNodes).sort((a, b) => {
      // Parse the steps (e.g., "1.1" vs "2.1")
      const [aMajor, aMinor] = a.split('.').map(Number);
      const [bMajor, bMinor] = b.split('.').map(Number);
      
      if (aMajor !== bMajor) {
        return aMajor - bMajor;
      }
      return aMinor - bMinor;
    });

    return sortedSteps
      .map(step => `
        <div>
          <h3>${step} - ${groupedNodes[step].title}</h3>
          <p>${[...new Set(groupedNodes[step].text)].join('<br><br>')}</p>
        </div>`)
      .join('');
  }

  clearSelection() {
    this.selectedNodes = [];
    document.querySelectorAll('.timeline-step.selected')
      .forEach(step => step.classList.remove('selected'));
    this.updateOverlay();
  }
}

// Event Handlers
class EventHandlers {
  static initializeEventListeners() {
    const selectionManager = new SelectionManager();

    // Main Timeline Click
    document.querySelector('.timeline-container.main')?.addEventListener('click', () => {
      EventHandlers.activateAllFilters();
    });

    // Filter Button Click
    document.querySelectorAll('.filter-btn').forEach(button => {
      button.addEventListener('click', () => EventHandlers.handleFilterClick(button));
    });

    // Timeline Step Click
    document.addEventListener('click', (e) => {
      const timelineStep = e.target.closest('.timeline-step');
      if (timelineStep && !timelineStep.closest('.timeline-container.main')) {
        const persona = timelineStep.closest('.timeline-container')?.getAttribute('data-persona');
        if (persona) {
          selectionManager.toggleNodeSelection(timelineStep, persona);
        }
      }
    });

    // Initialize Clear Selection Button
    EventHandlers.initializeClearButton(selectionManager);
  }

  static activateAllFilters() {
    document.querySelectorAll('.filter-btn').forEach(button => {
      if (!button.classList.contains('active')) {
        button.classList.add('active');
        const target = button.getAttribute('data-target');
        document.querySelectorAll(`.timeline-container[data-persona="${target}"]`)
          .forEach(timeline => timeline.style.display = 'grid');
      }
    });
  }

  static handleFilterClick(button) {
    const target = button.getAttribute('data-target');
    button.classList.toggle('active');
    const isActive = button.classList.contains('active');

    document.querySelectorAll('.timeline-container').forEach(timeline => {
      const persona = timeline.getAttribute('data-persona');
      if (persona?.includes(target)) {
        timeline.style.display = isActive ? 'grid' : 'none';
      }
    });
  }

  static initializeClearButton(selectionManager) {
    const overlay = document.getElementById('overlay');
    if (!overlay) {
      console.warn('Overlay element not found');
      return;
    }

    const clearButton = document.createElement('button');
    clearButton.textContent = 'Clear Selection';
    clearButton.className = 'clear-selection-btn';
    clearButton.style.cssText = `
      margin-top: 20px;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      background-color: #1B998B;
      color: white;
      cursor: pointer;
    `;
    clearButton.onclick = () => selectionManager.clearSelection();
    overlay.appendChild(clearButton);
  }
}

// Initialize on DOM Load
document.addEventListener('DOMContentLoaded', () => {
  const mainTimeline = document.querySelector('.timeline-container.main');
  if (mainTimeline) {
    mainTimeline.innerHTML = TimelineGenerator.generateMainTimeline();
  }

  document.querySelectorAll('.timeline-container.collapsed').forEach(container => {
    const persona = container.getAttribute('data-persona');
    if (persona) {
      container.innerHTML = TimelineGenerator.generatePersonaTimeline(persona);
    }
  });

  EventHandlers.initializeEventListeners();
});
  </script>
   
  
</body>
</html>